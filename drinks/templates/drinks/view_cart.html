{% extends "drinks/layout.html" %}
{% block body %}
        <script
            src="https://www.paypal.com/sdk/js?client-id=AZci21POXG3JTRRsL0Lt_FY2m43muEA36bKYKOvATmhRmiNfWqOtG_JV3RJymqtjrIKTL2-9nw_R844k&currency=AUD"> // Required. Replace SB_CLIENT_ID with your sandbox client ID.
        </script>

        {% if test%}
            <div>{{test}}</div>
        {% endif %}
        <h1>My Cart</h1>
        <div class='row'>
            {% for key, value in cart.items %}
                <div class='col-3'>Image Here {{key}}</div>   
                <div class='col-9 product-name'>{{value.name}}</div>  
                <div class='col-4'>
                  <form action="{% url 'update_cartitem' key %}" method="post">
                        {% csrf_token %}
                        <input type="number" name="quantity" min="0" value="{{value.quantity}}">
                        <input type="submit" value="Update Quantity">
                    </form>    
                </div>
                <div class='col-4'>*Unit Price: ${{value.price}}</div>
                <div class='col-4'>=Item Total Price: ${{value.total_price}}</div>
                <form action="{% url 'delete_cartitem' key %}" method="post">
                        {% csrf_token %}
                        <input type="submit" value="Remove from Cart">
                </form>  
            {% empty %}
                <li>No drinks</li>
            {% endfor %}
            <div>Cart Total Price = ${{cart_total_price}}</div>
            <div id="paypal-button-container"></div>
        </div>
            <a href="{% url 'index' %}">Back to Drinks List</a>
  <script>    
        paypal.Buttons({
            createOrder: function(data, actions) {
                // This function sets up the details of the transaction, including the amount and line item details.
                return actions.order.create({
                    purchase_units: [{
                        amount:{
                            value: '{{cart_total_price}}',
                            currency_code: 'AUD',
                            breakdown: {
                                item_total: {value: '{{cart_total_price}}', currency_code: 'AUD'}
                            }
                        },
                        items: [{% for key, value in cart.items %}
                                {
                                    name: '{{value.name}}',
                                    unit_amount: {value: '{{value.price}}', currency_code: 'AUD'},
                                    quantity: '{{value.quantity}}'
                                },
                            {% endfor %}
                        ]
                    }]
                });
            },
            onApprove: function(data, actions) {
                // This function captures the funds from the transaction.
                return actions.order.capture().then(function(details) {
                    // This function shows a transaction success message to your buyer.
                    alert('Transaction completed by ' + details.payer.name.given_name);

                });
            }
        }).render('#paypal-button-container');
  </script>
</body>
{% endblock %}